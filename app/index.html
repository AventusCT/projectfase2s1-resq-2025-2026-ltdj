<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Item Location Tracker</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div id="app">
        <!-- User Selection View -->
        <div id="userSelection" class="min-h-screen flex items-center justify-center">
            <div class="container">
                <div class="space-y-8">
                    <div class="text-center space-y-4">
                        <h1 class="text-4xl font-bold">Item Location Tracker</h1>
                        <p class="text-xl text-muted">Please select your user type to continue</p>
                    </div>

                    <div class="grid grid-2 gap-6">
                        <!-- Worker Card -->
                        <div class="card user-card" onclick="selectUser('worker')">
                            <div class="card-header text-center space-y-4">
                                <div class="user-icon worker">
                                    <svg class="icon-lg" fill="currentColor" viewBox="0 0 24 24">
                                        <path d="M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"/>
                                    </svg>
                                </div>
                                <div>
                                    <h2 class="text-2xl font-medium">Worker</h2>
                                    <p class="text-muted">View-only access to item locations</p>
                                </div>
                            </div>
                            <div class="card-content space-y-4">
                                <div class="space-y-3">
                                    <h4 class="font-medium">What you can do:</h4>
                                    <ul class="space-y-2 text-sm text-muted">
                                        <li class="flex items-center gap-2">
                                            <span style="color: #16a34a;">✓</span>
                                            View warehouse grid layout
                                        </li>
                                        <li class="flex items-center gap-2">
                                            <span style="color: #16a34a;">✓</span>
                                            See item locations and details
                                        </li>
                                        <li class="flex items-center gap-2">
                                            <span style="color: #dc2626;">✗</span>
                                            <span class="line-through">Add or edit items</span>
                                        </li>
                                        <li class="flex items-center gap-2">
                                            <span style="color: #dc2626;">✗</span>
                                            <span class="line-through">Access table management</span>
                                        </li>
                                    </ul>
                                </div>
                                <button class="button button-outline" style="width: 100%;">
                                    Continue as Worker
                                </button>
                            </div>
                        </div>

                        <!-- Manager Card -->
                        <div class="card user-card" onclick="selectUser('manager')">
                            <div class="card-header text-center space-y-4">
                                <div class="user-icon manager">
                                    <svg class="icon-lg" fill="currentColor" viewBox="0 0 24 24">
                                        <path d="M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"/>
                                        <path d="M16 8l2 2 4-4" stroke="currentColor" stroke-width="2" fill="none"/>
                                    </svg>
                                </div>
                                <div>
                                    <h2 class="text-2xl font-medium">Manager</h2>
                                    <p class="text-muted">Full access to manage all items</p>
                                </div>
                            </div>
                            <div class="card-content space-y-4">
                                <div class="space-y-3">
                                    <h4 class="font-medium">What you can do:</h4>
                                    <ul class="space-y-2 text-sm text-muted">
                                        <li class="flex items-center gap-2">
                                            <span style="color: #16a34a;">✓</span>
                                            Access table management view
                                        </li>
                                        <li class="flex items-center gap-2">
                                            <span style="color: #16a34a;">✓</span>
                                            View warehouse grid layout
                                        </li>
                                        <li class="flex items-center gap-2">
                                            <span style="color: #16a34a;">✓</span>
                                            Add, edit, and remove items
                                        </li>
                                        <li class="flex items-center gap-2">
                                            <span style="color: #16a34a;">✓</span>
                                            Full system administration
                                        </li>
                                    </ul>
                                </div>
                                <button class="button button-primary" style="width: 100%;">
                                    Continue as Manager
                                </button>
                            </div>
                        </div>
                    </div>

                    <div class="text-center">
                        <p class="text-sm text-muted">
                            You can switch between user types at any time using the "Switch User" button
                        </p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Main Application -->
        <div id="mainApp" class="hidden">
            <div class="container space-y-6">
                <!-- Header -->
                <div class="flex justify-between items-center">
                    <div class="text-center space-y-2" style="flex: 1;">
                        <h1 class="text-3xl font-bold">Item Location Tracker</h1>
                        <p id="headerDescription" class="text-muted"></p>
                    </div>
                    
                    <div class="flex items-center gap-3">
                        <span id="userBadge" class="badge"></span>
                        <button class="button button-outline button-sm" onclick="switchUser()">
                            Switch User
                        </button>
                    </div>
                </div>

                <!-- Worker View - Grid Only -->
                <div id="workerView" class="hidden">
                    <div class="card">
                        <div class="card-header">
                            <h2 class="card-title">Warehouse Grid Layout</h2>
                            <p class="card-description">Visual representation of item locations in the warehouse</p>
                        </div>
                        <div class="card-content">
                            <div id="workerGrid"></div>
                        </div>
                    </div>
                </div>

                <!-- Manager View - Tabs -->
                <div id="managerView" class="hidden">
                    <div class="tabs">
                        <div class="tabs-list">
                            <button class="tabs-trigger active" onclick="switchTab('table')">Table View</button>
                            <button class="tabs-trigger" onclick="switchTab('grid')">Grid View</button>
                        </div>
                        
                        <!-- Table Tab -->
                        <div id="tableTab" class="tabs-content active">
                            <div class="card">
                                <div class="card-header">
                                    <h2 class="card-title">Items Management</h2>
                                    <p class="card-description">Manage all items and their exact locations (row and column positions)</p>
                                </div>
                                <div class="card-content">
                                    <div class="space-y-4">
                                        <div class="flex justify-between items-center">
                                            <div>
                                                <h3 class="font-medium">Items (<span id="itemCount">0</span>)</h3>
                                                <p class="text-sm text-muted">Manage your items and their locations</p>
                                            </div>
                                            <button class="button button-outline" onclick="saveItems()">
                                                Save
                                            </button>
                                            <button class="button button-primary" onclick="openAddModal()">
                                                <svg class="icon" fill="currentColor" viewBox="0 0 24 24">
                                                    <path d="M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z"/>
                                                </svg>
                                                Add Item
                                            </button>
                                        </div>
                                        
                                        <div style="border: 1px solid var(--border); border-radius: var(--radius); overflow: hidden;">
                                            <table class="table" id="itemsTable">
                                                <thead>
                                                    <tr>
                                                        <th>Item Name</th>
                                                        <th>Location</th>
                                                        <th>Category</th>
                                                        <th>Description</th>
                                                        <th style="width: 100px;">Actions</th>
                                                    </tr>
                                                </thead>
                                                <tbody id="itemsTableBody">
                                                </tbody>
                                            </table>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Grid Tab -->
                        <div id="gridTab" class="tabs-content">
                            <div class="card">
                                <div class="card-header">
                                    <h2 class="card-title">Grid Layout</h2>
                                    <p class="card-description">Visual representation of item locations in a grid format</p>
                                </div>
                                <div class="card-content">
                                    <div id="managerGrid"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Instructions -->
                <div class="card">
                    <div class="card-content space-y-1">
                        <p class="font-medium">How to use:</p>
                        <ul id="instructions" style="list-style: disc; padding-left: 1.5rem; margin-top: 0.25rem;">
                        </ul>
                    </div>
                </div>
            </div>
        </div>

        <!-- Add/Edit Modal -->
        <div id="itemModal" class="modal hidden">
            <div class="modal-content">
                <div class="modal-header">
                    <h2 id="modalTitle">Add New Item</h2>
                    <p class="text-muted" id="modalDescription">Add a new item and specify its location in the grid.</p>
                </div>
                <div class="modal-body space-y-4">
                    <div>
                        <label class="label">Item Name</label>
                        <input type="text" class="input" id="itemName" placeholder="Enter item name">
                    </div>
                    
                    <div class="grid grid-2 gap-4">
                        <div>
                            <label class="label">Row</label>
                            <input type="number" class="input" id="itemRow" min="1" max="10" value="1">
                        </div>
                        <div>
                            <label class="label">Column</label>
                            <input type="number" class="input" id="itemColumn" min="1" max="10" value="1">
                        </div>
                    </div>

                    <div id="locationWarning" class="bg-destructive-light hidden">
                        ⚠️ Location is already occupied
                    </div>
                    
                    <div>
                        <label class="label">Category</label>
                        <select class="select" id="itemCategory">
                            <option value="">Select a category</option>
                            <option value="Electronics">Electronics</option>
                            <option value="Furniture">Furniture</option>
                            <option value="Supplies">Supplies</option>
                            <option value="Appliances">Appliances</option>
                            <option value="Lighting">Lighting</option>
                            <option value="Other">Other</option>
                        </select>
                    </div>
                    
                    <div>
                        <label class="label">Description (Optional)</label>
                        <input type="text" class="input" id="itemDescription" placeholder="Enter item description">
                    </div>
                </div>
                <div class="modal-footer">
                    <button class="button button-outline" onclick="closeModal()">Cancel</button>
                    <button class="button button-primary" id="modalSubmit" onclick="submitItem()">Add Item</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Application State
        let currentUser = null;
        let currentTab = 'table';
        let highlightedLocation = null;
        let editingItemId = null;
        let items = [];

        function saveItems() {
            localStorage.setItem("items", JSON.stringify(items));
        }

        async function loadItems() {
            const stored = localStorage.getItem("items");
            if (stored) {
                items = JSON.parse(stored);
            } else {
                const response = await fetch("Data/Items.json");
                items = await response.json();
            }
            updateUI();
        }

document.addEventListener("DOMContentLoaded", loadItems);

        // Utility Functions
        function selectUser(userType) {
            currentUser = userType;
            document.getElementById('userSelection').classList.add('hidden');
            document.getElementById('mainApp').classList.remove('hidden');
            updateUI();
        }

        function switchUser() {
            currentUser = null;
            document.getElementById('userSelection').classList.remove('hidden');
            document.getElementById('mainApp').classList.add('hidden');
        }

        function switchTab(tab) {
            currentTab = tab;
            document.querySelectorAll('.tabs-trigger').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.tabs-content').forEach(t => t.classList.remove('active'));
            
            document.querySelector(`[onclick="switchTab('${tab}')"]`).classList.add('active');
            document.getElementById(`${tab}Tab`).classList.add('active');
            
            if (tab === 'grid') {
                renderGrid('managerGrid');
            }
        }

        function updateUI() {
            const isManager = currentUser === 'manager';
            const isWorker = currentUser === 'worker';

            // Update header
            document.getElementById('headerDescription').textContent = isWorker 
                ? "View item locations in the warehouse grid system"
                : "Track and manage the locations of your items using a grid-based system";

            // Update user badge
            const badge = document.getElementById('userBadge');
            badge.textContent = currentUser === 'manager' ? 'Manager' : 'Worker';
            badge.className = `badge ${isManager ? '' : 'badge-gray'}`;

            // Show appropriate view
            document.getElementById('workerView').classList.toggle('hidden', !isWorker);
            document.getElementById('managerView').classList.toggle('hidden', !isManager);

            // Update instructions
            const instructions = document.getElementById('instructions');
            if (isWorker) {
                instructions.innerHTML = `
                    <li>View the grid to see where all items are located in the warehouse</li>
                    <li>Click on grid cells to highlight specific locations</li>
                    <li>Hover over items to see detailed information in tooltips</li>
                    <li>Use the legend to understand the color coding and symbols</li>
                `;
            } else {
                instructions.innerHTML = `
                    <li>Use the <strong>Table View</strong> to manage all items and their exact locations</li>
                    <li>Use the <strong>Grid View</strong> to visualize where items are positioned</li>
                    <li>Hover over locations in the table to highlight them in the grid</li>
                    <li>Click "Add Item" to add new items to specific locations</li>
                    <li>Edit or remove items using the action buttons in the table</li>
                `;
            }

            // Render content
            if (isWorker) {
                renderGrid('workerGrid');
            } else {
                renderTable();
                if (currentTab === 'grid') {
                    renderGrid('managerGrid');
                }
            }
        }

        function renderTable() {
            const tbody = document.getElementById('itemsTableBody');
            const itemCount = document.getElementById('itemCount');
            
            itemCount.textContent = items.length;
            
            if (items.length === 0) {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="5" style="text-align: center; padding: 2rem; color: var(--muted-foreground);">
                            No items found. Click "Add Item" to get started.
                        </td>
                    </tr>
                `;
                return;
            }

            tbody.innerHTML = items.map(item => `
                <tr onmouseenter="highlightLocation(${item.row}, ${item.column})" onmouseleave="highlightLocation(null)">
                    <td class="font-medium">${item.name}</td>
                    <td>
                        <div class="flex items-center gap-1" style="cursor: pointer;">
                            <svg class="icon-sm" fill="currentColor" viewBox="0 0 24 24">
                                <path d="M12 2C8.13 2 5 5.13 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.87-3.13-7-7-7zm0 9.5c-1.38 0-2.5-1.12-2.5-2.5s1.12-2.5 2.5-2.5 2.5 1.12 2.5 2.5-1.12 2.5-2.5 2.5z"/>
                            </svg>
                            Row ${item.row}, Column ${item.column}
                        </div>
                    </td>
                    <td>
                        ${item.category ? `<span class="badge ${getCategoryClass(item.category)}">${item.category}</span>` : ''}
                    </td>
                    <td class="text-muted">${item.description || '—'}</td>
                    <td>
                        <div class="flex items-center gap-1">
                            <button class="button button-ghost" onclick="editItem('${item.id}')">
                                <svg class="icon-sm" fill="currentColor" viewBox="0 0 24 24">
                                    <path d="M3 17.25V21h3.75L17.81 9.94l-3.75-3.75L3 17.25zM20.71 7.04c.39-.39.39-1.02 0-1.41l-2.34-2.34c-.39-.39-1.02-.39-1.41 0l-1.83 1.83 3.75 3.75 1.83-1.83z"/>
                                </svg>
                            </button>
                            <button class="button button-ghost" onclick="deleteItem('${item.id}')">
                                <svg class="icon-sm" fill="currentColor" viewBox="0 0 24 24">
                                    <path d="M6 19c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7H6v12zM19 4h-3.5l-1-1h-5l-1 1H5v2h14V4z"/>
                                </svg>
                            </button>
                        </div>
                    </td>
                </tr>
            `).join('');
        }

        function renderGrid(containerId) {
            const container = document.getElementById(containerId);
            const maxRow = Math.max(5, ...items.map(item => item.row));
            const maxColumn = Math.max(5, ...items.map(item => item.column));

            let html = `
                <div class="space-y-4">
                    <div class="text-sm text-muted">
                        <p>Grid Layout (${maxRow} × ${maxColumn})</p>
                        <p>Hover over locations in the table to highlight them here</p>
                    </div>
                    
                    <div class="grid-container">
                        <!-- Column headers -->
                        <div class="grid-header">
                            <div class="grid-label"></div>
                            ${Array.from({length: maxColumn}, (_, i) => `
                                <div class="grid-label">Col ${i + 1}</div>
                            `).join('')}
                        </div>
                        
                        <!-- Grid rows -->
                        ${Array.from({length: maxRow}, (_, rowIndex) => {
                            const row = rowIndex + 1;
                            return `
                                <div class="grid-row">
                                    <div class="grid-label">Row ${row}</div>
                                    ${Array.from({length: maxColumn}, (_, colIndex) => {
                                        const column = colIndex + 1;
                                        const item = items.find(item => item.row === row && item.column === column);
                                        const isHighlighted = highlightedLocation && highlightedLocation.row === row && highlightedLocation.column === column;
                                        
                                        return `
                                            <div class="grid-cell tooltip ${item ? '' : 'empty'} ${isHighlighted ? 'highlighted' : ''}" 
                                                 onclick="gridCellClick(${row}, ${column})">
                                                ${item ? `
                                                    <div class="grid-item-name">${item.name}</div>
                                                    ${item.category ? `<span class="badge ${getCategoryClass(item.category)}">${item.category}</span>` : ''}
                                                    <div class="tooltip-content">
                                                        <div class="font-medium">Row ${row}, Column ${column}</div>
                                                        <div class="font-medium">${item.name}</div>
                                                        ${item.category ? `<div>Category: ${item.category}</div>` : ''}
                                                        ${item.description ? `<div>${item.description}</div>` : ''}
                                                    </div>
                                                ` : `
                                                    <div class="text-xs text-muted">${row},${column}</div>
                                                    <div class="tooltip-content">
                                                        <div class="font-medium">Row ${row}, Column ${column}</div>
                                                        <div>Empty location</div>
                                                    </div>
                                                `}
                                            </div>
                                        `;
                                    }).join('')}
                                </div>
                            `;
                        }).join('')}
                    </div>

                    <!-- Legend -->
                    <div class="card">
                        <div class="card-content">
                            <h4 class="font-medium" style="margin-bottom: 0.5rem;">Legend</h4>
                            <div class="grid grid-3 gap-3 text-sm">
                                <div class="flex items-center gap-2">
                                    <div style="width: 1rem; height: 1rem; background: var(--card); border: 1px solid var(--border); border-radius: calc(var(--radius) - 4px);"></div>
                                    <span>Occupied</span>
                                </div>
                                <div class="flex items-center gap-2">
                                    <div style="width: 1rem; height: 1rem; background: var(--muted); border: 1px solid var(--border); border-radius: calc(var(--radius) - 4px);"></div>
                                    <span>Empty</span>
                                </div>
                                <div class="flex items-center gap-2">
                                    <div style="width: 1rem; height: 1rem; background: color-mix(in srgb, var(--primary) 10%, transparent); border: 2px solid var(--primary); border-radius: calc(var(--radius) - 4px);"></div>
                                    <span>Highlighted</span>
                                </div>
                            </div>
                            
                            <div style="margin-top: 0.75rem; padding-top: 0.75rem; border-top: 1px solid var(--border);">
                                <div class="text-xs text-muted font-medium">Categories:</div>
                                <div class="flex gap-2" style="margin-top: 0.25rem; flex-wrap: wrap;">
                                    ${['Electronics', 'Furniture', 'Supplies', 'Appliances', 'Lighting'].map(category => 
                                        `<span class="badge ${getCategoryClass(category)}">${category}</span>`
                                    ).join('')}
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            `;

            container.innerHTML = html;
        }

        function getCategoryClass(category) {
            const classes = {
                'Electronics': 'badge-blue',
                'Furniture': 'badge-amber',
                'Supplies': 'badge-green',
                'Appliances': 'badge-purple',
                'Lighting': 'badge-yellow'
            };
            return classes[category] || 'badge-gray';
        }

        function highlightLocation(row, column) {
            if (row === null || column === null) {
                highlightedLocation = null;
            } else {
                highlightedLocation = { row, column };
            }
            
            if (currentUser === 'worker') {
                renderGrid('workerGrid');
            } else if (currentTab === 'grid') {
                renderGrid('managerGrid');
            }
        }

        function gridCellClick(row, column) {
            const existingItem = items.find(item => item.row === row && item.column === column);
            if (existingItem) {
                highlightLocation(row, column);
            }
        }

        function openAddModal() {
            editingItemId = null;
            document.getElementById('modalTitle').textContent = 'Add New Item';
            document.getElementById('modalDescription').textContent = 'Add a new item and specify its location in the grid.';
            document.getElementById('modalSubmit').textContent = 'Add Item';
            
            // Reset form
            document.getElementById('itemName').value = '';
            document.getElementById('itemRow').value = '1';
            document.getElementById('itemColumn').value = '1';
            document.getElementById('itemCategory').value = '';
            document.getElementById('itemDescription').value = '';
            
            document.getElementById('itemModal').classList.remove('hidden');
            validateLocation();
        }

        function editItem(id) {
            const item = items.find(i => i.id === id);
            if (!item) return;
            
            editingItemId = id;
            document.getElementById('modalTitle').textContent = 'Edit Item';
            document.getElementById('modalDescription').textContent = 'Update the item details and location.';
            document.getElementById('modalSubmit').textContent = 'Update Item';
            
            // Fill form
            document.getElementById('itemName').value = item.name;
            document.getElementById('itemRow').value = item.row;
            document.getElementById('itemColumn').value = item.column;
            document.getElementById('itemCategory').value = item.category || '';
            document.getElementById('itemDescription').value = item.description || '';
            
            document.getElementById('itemModal').classList.remove('hidden');
            validateLocation();
        }

        function closeModal() {
            document.getElementById('itemModal').classList.add('hidden');
            editingItemId = null;
        }

        function validateLocation() {
            const row = parseInt(document.getElementById('itemRow').value);
            const column = parseInt(document.getElementById('itemColumn').value);
            const warning = document.getElementById('locationWarning');
            const submit = document.getElementById('modalSubmit');
            
            const isOccupied = items.some(item => 
                item.row === row && 
                item.column === column && 
                item.id !== editingItemId
            );
            
            if (isOccupied) {
                warning.classList.remove('hidden');
                warning.textContent = `⚠️ Location Row ${row}, Column ${column} is already occupied`;
                submit.disabled = true;
            } else {
                warning.classList.add('hidden');
                submit.disabled = false;
            }
        }

        function submitItem() {
            const name = document.getElementById('itemName').value.trim();
            const row = parseInt(document.getElementById('itemRow').value);
            const column = parseInt(document.getElementById('itemColumn').value);
            const category = document.getElementById('itemCategory').value;
            const description = document.getElementById('itemDescription').value.trim();
            
            if (!name) return;
            
            if (editingItemId) {
                // Update existing item
                const index = items.findIndex(i => i.id === editingItemId);
                if (index !== -1) {
                    items[index] = {
                        ...items[index],
                        name,
                        row,
                        column,
                        category: category || undefined,
                        description: description || undefined
                    };
                }
            } else {
                // Add new item
                items.push({
                    id: Date.now().toString(),
                    name,
                    row,
                    column,
                    category: category || undefined,
                    description: description || undefined
                });
            }
            
            closeModal();
            updateUI();
        }

        function deleteItem(id) {
            if (confirm('Are you sure you want to delete this item?')) {
                items = items.filter(item => item.id !== id);
                updateUI();
            }
        }

        // Event listeners
        document.getElementById('itemRow').addEventListener('input', validateLocation);
        document.getElementById('itemColumn').addEventListener('input', validateLocation);
        document.getElementById('itemName').addEventListener('input', function() {
            document.getElementById('modalSubmit').disabled = !this.value.trim();
        });

        // Close modal when clicking outside
        document.getElementById('itemModal').addEventListener('click', function(e) {
            if (e.target === this) {
                closeModal();
            }
        });

        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            // Application starts with user selection
        });
    </script>
</body>
</html>